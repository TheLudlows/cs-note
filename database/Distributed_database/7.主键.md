#### 自增ID

自增主键给开发人员提供了很大的便利。主键必须要保证唯一，而且多数设计规范 都会要求，主键不要带有业务属性，所以如果数据库没有内置这个特性，应用开发人员就必须自己设计一套主键的生成逻辑。

单体数据库可以保证唯一和单调递增，但无法保证连续。多个事务并发执行，会部分事务回滚导致主键ID出现空洞。

在分布式数据库中，产生自增主键难点就在单调递增，单调递增这个要求和全局时钟中的 TSO 是很相似的，其次，使用单调递增的主键，也会给分布式数据库的写入带来问题。这个问题是在 Range 分片下发生的，我们通常将这个问题称为 “尾部热点”。

#### 内置 UUID

UUID（Universally Unique Identifier）可能是最经常使用的一种唯一 ID 算法， CockroachDB 也建议使用 UUID 作为主键，并且内置了同名的数据类型和函数。UUID 是 由 32 个的 16 进制数字组成，所以每个 UUID 的长度是 128 位（16^32 = 2^128）。

但是，UUID 的缺点很明显，那就是键值长度过长，达到了 128 位，因此存储和计算的代 价都会增加

#### 内置 Radom ID

TiDB 默认是支持自增主键的，对未声明主键的表，会提供了一个隐式主键 _tidb_rowid， 因为这个主键大体上是单调递增的，所以也会出现我们前面说的“尾部热点”问题。

TiDB 也提供了 UUID 函数，而且在 4.0 版本中还提供了另一种解决方案 AutoRandom。 TiDB 模仿 MySQL 的 AutoIncrement，提供了 AutoRandom 关键字用于生成一个随机 ID 填充指定列。

这个随机 ID 是一个 64 位整型，分为三个部分。

1. 第一部分的符号位没有实际作用。
2. 第二部分是事务开始时间，默认为 5 位，可以理解为事务时间戳的一种映射。
3. 第三部分则是自增的序列号, 使用其余位。

AutoRandom 可以保证表内主键唯一，用户也不需要关注分片情况。

#### 外置 Snowflake

雪花算法（Snowflake）是 Twitter 公司分布式项目采用的 ID 生成算法。这个算法生成的 ID 是一个 64 位的长整型，由四个部分构成：

1. 第一部分是 1 位的符号位，并没有实际用处，主要为了兼容长整型的格式。

2.  第二部分是 41 位的时间戳用来记录本地的毫秒时间。
3. 第三部分是机器 ID，这里说的机器就是生成 ID 的节点，用 10 位长度给机器做编码， 那意味着最大规模可以达到 1024 个节点（2^10）。
4. 最后是 12 位序列，序列的长度直接决定了一个节点 1 毫秒能够产生的 ID 数量，12 位 就是 4096（2^12）。