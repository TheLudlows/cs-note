#### 1. 查询优化
为了提高查询语句的执行效率，对查询语句进行优化是必不可少的。运用查询技术实现数据操纵功能的过程是确定给定查询的高效执行计划的过程。所谓执行计划就是查询树，它由一系列内部的操作符组成，这些操作符按一定的运算关系构成查询的一个执行方案。查询优化的追求目标，就是在数据库查询优化引擎生成一个执行策略的过程中，尽量使查询的总开销（总开销通常包括IO、CPU、网络传输等）达到最小。

数据库查询优化技术主要包括
- 查询重用技术
- 查询重写规则
- 查询算法优化技术
- 并行查询优化技术
- 分布式查询优化技术及
- 其他方面（如框架结构）的优化技术

这6项技术构成了一个“广义的数据库查询优化 ”的概念。狭义的数据库查询优化指“查询重写规则”和“查询算法优化”。

从优化的内容角度看，查询优化又分为代数优化/逻辑优化和物理优化。逻辑优化主要依据关系代数的等价变换做一些逻辑变换，物理优化主要根据数据读取、表连接方式、表连接顺序、排序等技术对查询进行优化。“查询重写规则”属于逻辑优化方式，运用了关系代数和启发式规则；查询算法优化属于物理优化方式，运用了基于代价估算的多表连接算法求解最小花费的技术。
逻辑优化可以细分为
- 语法级 查询语言层的优化，基于语法进行优化。

- 代数级 查询使用形式逻辑进行优化，运用关系代数的原理进行优化。

- 语义级 根据完整性约束，对查询语句进行语义理解，推知一些可优化的操作

#### 2. 查询重用
查询重用是指尽可能利用先前的执行结果，以达到节约查询计算全过程的时间并减少资源消耗的目的。“目前查询重用技术主要集中在两个方面：
- 查询结果的重用 。在缓存区中分配一块缓冲块，存放该SQL语句文本和最后的结果集，当遇到同样的SQL输入时，可直接把结果返回。查询结果的重用技术节约了查询计划生成时间和查询执行过程的时间，减少了查询执行全过程的资源消耗。

- 查询计划的重用 。缓存一条查询语句的执行计划及其相应语法树结构。查询计划的重用技术减少了查询计划生成的时间和资源消耗。

#### 3. 查询重写规则
查询重写是查询语句的一种等价转换 ，即对于任何相关模式的任意状态都会产生相同的结果， 查询重写有两个目标：

- 将查询转换为等价的、效率更高的形式，例如将效率低的谓词转换为效率高的谓词、消除重复条件等。

- 尽量将查询重写为等价、简单且不受表顺序限制的形式，为物理查询优化阶段提供更多的选择，如视图的重写、子查询的合并转换等。

查询重写技术优化思路主要包括：

- 将过程性查询转换为描述性的查询，如视图重写。

- 将复杂的查询（如嵌套子查询、外连接、嵌套连接）尽可能转换为多表连接查询。

- 将效率低的谓词转换为等价的效率高的谓词（如等价谓词重写）。

- 利用等式和不等式的性质，简化WHERE、HAVING和ON条件。

#### 4. 查询算法优化
查询计划也称为查询树，它由一系列内部的操作符组成，这些操作符按一定的运算关系构成查询的一个执行方案。形式上看是一颗二叉树，树叶是每个单表对象，两个树叶的父结点是一个连接操作符连接后的中间结果（另外还有一些其他结点如排序操作等也可以作为中间结果），这个结果是一个临时“关系”，这样直至根结点。

比如表A和表B连接得到中间结果，然后再和另外的表C连接得到新的中间方式，直至所有表连接完毕（连接操作就是操作符，这个示例有两个连接操作符。A连接B连接C、C连接B连接A就是两种不同的执行方案，是两个不同的执行计划，查询优化要选出最高效的一个执行方案。
查询计划涉及的主要“关系结点”包括：

- 单表结点 。考虑单表的数据获取方式，是直接通过IO获得数据，还是通过索引获取数据，或者是通过索引定位数据的位置后再经过IO到数据块中获取数据。这是一个从物理存储到内存解析成逻辑字段 的过程
- 两表结点 。表示的是内存中的元组怎么进行元组间的连接。 考虑两表以何种方式连接、代价有多大、连接路径有哪些等。“元组通常已经存在于内存中 ，直接使用即可。这是一个完成用户语义的逻辑操作，但是只是局部操作，只涉及两个具体的关系。完成用户全部语义（用户连接的语义），需要配合多表的连接顺序的操作。不同的连接算法导致的连接效率不同，如数据多时可使用Hash连接，外表数据量小且内表数据量大时可使用嵌套连接，数据如果有序可使用归并连接或先排序后使用归并连接等。
- 多表中间结点 。考虑多表连接顺序如何构成代价最少的“执行计划”。决定是AB先连接还是BC先连接，这是一个比较花费大小的运算。如果判断的连接方式太多，也会导致效率问题。多个关系采用不同次序进行连接，花费的CPU资源、内存资源差异可能较大。许多数据库采用左深树、右深树、紧密树3种方式或其中一部分对多表进行连接，得到多种连接路径。

查询算法优化目的就是生成最好的查询计划。生成最好的查询计划的策略通常有两个：

- 基于规则优化 。根据经验或一些已经探知或被证明有效的方式，定义为“规则”（如根据关系代数得知的规则、根据经验得知的规则等），用这些规则化简查询计划生成过程中符合可被化简的操作，使用启发式规则排除一些明显不好的存取路径，这就是基于规则的优化。

- 基于代价优化 。根据一个代价评估模型，在生成查询计划的过程中，计算每条存取路径（存取路径主要包括上述3个“关系结点”）的花费，然后选择“代价最小的作为子路径，这样直至所有表连接完毕得到一个完整的路径。主流数据库都采用了基于代价策略进行优化的技术。

#### 5. 并行查询优化
“传统单机数据库系统中，给定一个查询（Query），查询优化算法只需找到查询的一个具有最小执行花费的执行计划 ，这样的计划必定具有最快的响应时间。

在并行数据库系统中，查询优化的目标是寻找具有最小响应时间的查询执行计划 ，这需要把查询工作分解为一些可以并行运行的子工作。
如A、B、C、D4个表进行连接，每个表的单表扫描可以并行进行；在生成4个表连接的查询计划过程中，可选择A和B连接的同时C和D进行连接，这样连接操作能并行运行。

查询并行可以分为以下两种：

- 操作内并行 。将同一操作如单表扫描操作、两表连接操作、排序操作等分解成多个独立的子操作，由不同的CPU同时执行。

- 操作间并行 。一条SQL查询语句可以分解成多个子操作，由多个CPU执行。”

##### 6. 分布式查询优化
“在分布式数据库系统中，查询策略优化（主要是数据传输策略，A、B两结点的数据进行连接，是A结点数据传输到B结点或从B到A或先各自进行过滤然后再传输等）和局部处理优化（传统的单结点数据库的查询优化技术）是查询优化的重点。分布式数据库系统中的代价估算模型，除了考虑CPU代价和IO代价外，还要考虑通过网络在结点间传输数据的代价。



