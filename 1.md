#### 1. OS运行机制和体系结构
![](./OS运行机制和体系结构.png)

指令就是CPU能识别、执行的最基本命令。指令风味两种：特权指令和非特权指令，其中特权指令不允许用户程序时序。
同时CPU有两种状态，用户态和和心态，用户态下CPU只能执行非特权指令，核心态下CPU可以执行特权和非特权指令。
CPU的状态通过PSW寄存器中的标志位来标识CPU的状态。

操作系统的内核程序是系统的管理者，既可以执行非特权指令也可以执行特权指令，运行在核心态。而普通程序只能执行费特权指令，运行在用户态。

内核是计算机的底层软件，是操作系统最基本最核心的部分，其中时钟管理、中断处理原语与硬件管理较紧密。而有些操作系统把系统资源管理的程序不归类到内核中。这也是微内核和大内核的区别。

##### 2. 系统调用
操作系统作为用户和计算机硬件之间的接口，需要向上提供一些简单易用的服务。主要包括命令接
口和程序接口。其中程序接口由一组系统调用组成。系统调用是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用
程序调用的特殊函数，应用程序可以通过系统调用来请求获得操作系统内核的服务.

应用程序通过系统调用请求操作系统的服务。而系统中的各种共享资源都由操作系统内核统一掌管，因此凡是
与共享资源有关的操作（如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提
出服务请求，由操作系统内核代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。                     

系统调用的过程为：应用程序执行陷入指令（用户态）传递系统调用参数，执行相应的内请求核程序处理系统调用（核心态，返回应用程序
陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，使CPU进入核心态。发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行。  

#### 3. 异常和中断
中断的定义为，中断是指计算机运行过程中，出现某些意外情况需主机干预时，机器能自动停止正在运行的程序并转入处理新情况的程序，处理完毕后又返回原被暂停的程序继续运行。
中断又可以分为内中断和外中断，内中断也成为异常，内中断与当前执行的指令有关，中断信号的来自CPU内部，而与当前执行的指令无关，中断信号的来自CPU外部。  
![](./中断.png)
不同的中断信号，需要用不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号
的类型去查询“中断向量表”，以此来找到相应的中断处理程序在内存中的存放位置中断处理程序一定是内核程序，需要运行在内核态，中断是让操作系统内核夺回CPU使用权的唯一途径。